<!DOCTYPE html>
<html lang="zxx">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Male_Fashion Template" />
    <meta name="keywords" content="Male_Fashion, unica, creative, html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Cửa hàng thời trang T&P</title>

    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css" />
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css" />
    <link rel="stylesheet" href="css/nice-select.css" type="text/css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css" />
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="css/style.css" type="text/css" />
  </head>

  <body>

       <!-- Page Preloder -->
       <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Offcanvas Menu Begin -->
    <div class="offcanvas-menu-overlay"></div>
    <div class="offcanvas-menu-wrapper">
      <div class="offcanvas__option">
        <div class="offcanvas__links">
          <a href="#" onclick="dangnhap()">Đăng nhập</a>
          <a href="#">Đăng ký</a>
        </div>
      </div>
      <div class="offcanvas__nav__option">
        <a href="#" class="search-switch"
          ><img src="img/icon/search.png" alt=""
        /></a>
        <a href="#"><img src="img/icon/heart.png" alt="" /></a>
        <a href="./giohang.html"><img src="img/icon/cart.png" alt="" id="slspgh" />dqwdqwqwdqw</a>
        <div class="price"><span id="ttmenu"></span></div>
      </div>
      <div id="mobile-menu-wrap"></div>
      <div class="offcanvas__text">
        <p>
          Miễn phí vận chuyển, hoàn trả trong 30 ngày hoặc đảm bảo hoàn lại
          tiền.
        </p>
      </div>
    </div>
    <!-- Offcanvas Menu End -->

   <!-- Header Section Begin -->
   <header class="header">
    <!-- <div class="header__top">
      <div class="container">
        <div class="row">
          <div class="col-lg-6 col-md-7">
            <div class="header__top__left">
              <p>
                Miễn phí vận chuyển, hoàn trả trong 30 ngày hoặc đảm bảo hoàn
                lại tiền.
              </p>
            </div>
          </div>
          <div class="col-lg-6 col-md-5">
            <div class="header__top__right">
              <div class="header__top__links">
                <a href="#">Đăng nhập</a>
                <a href="#">Đăng ký</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div> -->
    <div class="container">
      <div class="row">
        <div class="col-lg-3 col-md-3">
          <div class="header__logo">
            <a href="./index.html"><img src="img/logo.png" alt="" /></a>
          </div>
        </div>
        <div class="col-lg-6 col-md-6">
          <nav class="header__menu mobile-menu">
            <ul>
              <li class="active"><a href="./index.html">Trang chủ</a></li>
              <li>
                <a href="./shop.html">Sản phẩm</a>
                <ul class="dropdown" id="drop_menu"></ul>
              </li>
              <!-- <li><a href="#">Pages</a>
                              <ul class="dropdown">
                                  <li><a href="./about.html">About Us</a></li>
                                  <li><a href="./shop-details.html">Shop Details</a></li>
                                  <li><a href="./shopping-cart.html">Shopping Cart</a></li>
                                  <li><a href="./checkout.html">Check Out</a></li>
                                  <li><a href="./blog-details.html">Blog Details</a></li>
                              </ul>
                          </li> -->
              <li><a href="./blog.html">Tin tức</a></li>
              <li><a href="./contact.html">Liên hệ</a></li>
            </ul>
          </nav>
        </div>
        <div class="col-lg-3 col-md-3">
          <div class="header__nav__option">
          
              <form action="timkiem.html">
                  <input type="text" placeholder="Tìm kiếm sản phẩm" name="search_product" required="không được bỏ trống">
                  <button type="submit" name="search_button"><img src="img/icon/search.png" alt=""/></button>
                  <a href="./giohang.html" id="hienThiSoLuong"><img src="img/icon/cart.png" alt="" /></a>
                </form>
                              
          </div>
        </div>
      </div>
      <div class="canvas__open"><i class="fa fa-bars"></i></div>
    </div>
  </header>
  <!-- Header Section End -->

    <!-- Shop Details Section Begin -->
    <section class="shop-details" id="deltail">
        <div class="product__details__pic">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product__details__breadcrumb">
                            <a href="./index.html">Trang chủ</a>
                            <a href="./shop.html">Sản phẩm</a>
                            <span>Chi tiết sản phẩm</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <!-- hiện hình -->
                </div>
            </div>
        </div>
        <div class="product__details__content">
            <div class="container">
                <div class="row d-flex justify-content-center">
                    <div class="col-lg-8" >
                     
                    </div>
                </div>
        
            </div>
        </div>
    </section>
    <!-- Shop Details Section End -->
  
    <!-- Related Section Begin -->
    <section class="related spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h3 class="related-title">Sản phẩm cùng danh mục</h3>
                </div>
            </div>
            <div class="row" id="list">
                <!-- show sản phẩm cùng loại -->
            </div>
        </div>
    </section>
    <section class="related spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h3 class="related-title">Nội dung bình luận</h3>
                </div>
            </div>
            <div class="row" id="show_bl">
                <!-- show bình luận -->
            
            </div>
        </div>
    </section>
    <!-- Related Section End -->
    <div class="container">
      <div class="blog__details__comment">
        <h4 style="font-size: 33px;
        font-weight: 800;">Bình luận</h4>
        <form action="#" style="margin-bottom: 4%;">
            <div class="row">
                <div class="col-lg-4 col-md-4">
                    <input type="text" placeholder="Ví dụ: Nguyễn Văn A" id="name">
                </div>
                <div class="col-lg-4 col-md-4">
                    <input type="email" placeholder="Ví dụ: phuly4795@gmail.com" id="email">
                </div>
                <div class="col-lg-4 col-md-4">
                    <input type="number" placeholder="Ví dụ: 0794248804" id="phone">
                </div>
                <div class="col-lg-12 text-center">
                    <textarea placeholder="Nhập nội dung" id="content"></textarea>
                    <button type="button" id="button" class="site-btn">Gửi bình luận</button>
                </div>
            </div>
        </form>
      </div>
    </div>
   <!-- Footer Section Begin -->
   <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-lg-3 col-md-6 col-sm-6">
          <div class="footer__about">
            <div class="footer__logo">
              <a href="#"><img src="img/footer-logo.png" alt="" /></a>
            </div>
            <p>
              Khách hàng là trọng tâm của mô hình kinh doanh độc đáo của chúng
              tôi, bao gồm cả thiết kế.
            </p>
            <a href="#"><img src="img/payment.png" alt="" /></a>
          </div>
        </div>
        <div class="col-lg-2 offset-lg-1 col-md-3 col-sm-6">
          <div class="footer__widget">
            <h6>Sản phẩm</h6>
            <ul id="show_pro_footer"></ul>
          </div>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-6">
          <div class="footer__widget">
            <h6>Dịch vụ</h6>
            <ul>
              <li><a href="#">Liên hệ với chúng tôi</a></li>
              <li><a href="#">Phương thức thanh toán</a></li>
              <li><a href="#">Vận chuyển</a></li>
              <li><a href="#">Trả lại & Trao đổi</a></li>
            </ul>
          </div>
        </div>
        <div class="col-lg-3 offset-lg-1 col-md-6 col-sm-6">
          <div class="footer__widget">
            <h6>Nhận thông báo</h6>
            <div class="footer__newslatter">
              <p>
                Hãy là người đầu tiên biết về hàng mới xuất hiện, xem sách,
                bán hàng và quảng cáo!
              </p>
              <form action="#">
                <input type="text" placeholder="Nhập email của bạn" />
                <button type="submit">
                  <span class="icon_mail_alt"></span>
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12 text-center">
          <div class="footer__copyright__text">
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            <p>
              Bản quyền thuộc Thành Phú ©
              <script>
                document.write(new Date().getFullYear());
              </script>
            </p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!-- Footer Section End -->

    <!-- Search Begin -->
    <div class="search-model">
        <div class="h-100 d-flex align-items-center justify-content-center">
            <div class="search-close-switch">+</div>
            <form class="search-model-form">
                <input type="text" id="search-input" placeholder="Search here.....">
            </form>
        </div>
    </div>
    <!-- Search End -->

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/jquery.nicescroll.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>
</body>

</html>
<script>
    // lấy chi tiết sản phẩm
    let output = "";
    let params = new URLSearchParams(location.search);
    let id = params.get("id");
    var itemHtml = document.querySelector("#deltail");
   

    var url = `http://localhost:3000/product/${id}`;
    fetch(url)
    .then(res => res.json())

    .then((chitietsp) => {

         return  `
         <section class="shop-details">
         <div class="product__details__pic">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product__details__breadcrumb">
                            <a href="./index.html">Trang chủ</a>
                            <a href="./shop.html">Sản phẩm</a>
                            <span>Chi tiết sản phẩm </span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3 col-md-3">
                            
                    </div>
                    <div class="col-lg-6 col-md-9">
                        <div class="tab-content">
                            <div class="tab-pane active" id="tabs-1" role="tabpanel">
                                <div class="product__details__pic__item">
                                    <img src="${chitietsp.image}" alt="">
                                </div>
                            </div>             
                        </div>
                    </div>
                </div>
            </div>
        </div>
         <div class="product__details__content">
            <div class="container">
                <div class="row d-flex justify-content-center">
                    <div class="col-lg-8">
                        <div class="product__details__text">
                            <h4>${chitietsp.name}</h4>                         
                            <h3>${chitietsp.price.toLocaleString('vi', {style : 'currency', currency : 'VND'})}</h3>
                            <p>${chitietsp.detail}</p>
                           
                            <div class="product__details__cart__option">
                              <div class="product__details__option__size">
                                    <span>Size:</span>
                                    <select name="" id="size" value ="rong" >
                                        <option value="0">Vui lòng chọn size</option>
                                        <option value="${chitietsp.size['0']}">S</option>
                                        <option value="${chitietsp.size['1']}">M</option>
                                        <option value="${chitietsp.size['2']}">L</option>
                                    </select>
                                </div>
                                <div class="quantity">
                                    <div class="pro-qty">
                                        <input onclick ='sl()' type="text" value="1" id="sl">
                                    </div>
                                </div>
                               
                                <a href="" onclick ="themVaoGio(${chitietsp.id}, '${chitietsp.name}',  ${chitietsp.price}, '${chitietsp.image}')" class="primary-btn">Thêm giỏ hàng</a>
                            </div>                                              
                        </div>
                    </div>
                </div>
              
            </div>
        </div>  
    </section>/
         `;
        //  itemHtml.innerHTML = output;
        // chitietsp.forEach((item) =>{
        //     console.log(item)  
   
        // }).join('')
       
    })
    .then(data => {
       
         itemHtml.innerHTML = data;
    })
</script>
<script>
  // thêm vào giỏ hàng

  function sl(){
    let sl = document.querySelector('#sl').value
    return Number(sl) 
  }
 
  function size(){
    let size = document.querySelector("#size").value
    return size
  }
 
  function themVaoGio(id, ten, gia, hinh) {
   
    let soluong =sl()

    let size2 = size();

    if(size2 == 0){

      alert("Bạn chưa chọn size");

      return false;
    }

    var cart = JSON.parse(localStorage.getItem("cart"));
  
    if (cart == null) {

      cart = [];
      
      cart.push({ id: id, name: ten,size: size2, price: gia, image: hinh, quantity: soluong });
  
    }else {
      let item = cart.find((item) => item.id === id);
      if (item) item.quantity+=soluong ; 
      else cart.push({ id: id, name: ten,size: size2, price: gia, image: hinh, quantity: soluong });
    }
    localStorage.setItem("cart", JSON.stringify(cart));
    
  }
</script>
    <script>
        // lấy danh sách catagory
        var url = "http://localhost:3000/Category";
      
        fetch(url)
          .then((data) => data.json()) // ko nói gì hết là dùng phương thức get
          .then((category) => {
            cat_arr = category.map((cat) => {
              return `<li><a href="shop.html?id=${cat.id}">${cat.name}</a></li>`;
            }).join('')
           
          
            document.querySelector("#drop_menu").innerHTML += cat_arr;
            document.querySelector("#show_pro_footer").innerHTML += cat_arr;
          });
      </script>
      <script>
      //  sản phẩm cùng loại

        let params1 = new URLSearchParams(location.search);
    
        let id_cate= params1.get("id_cate");
        
        url = `http://localhost:3000/product?cate_id=${id_cate}`;
    
        fetch(url)
        
        .then( res => res.json())
    
        .then ( listSP => {
            
          listSP.forEach( sp => { 
    
                document.querySelector('#list').innerHTML+= `
                <div class="col-lg-3 col-md-6 col-sm-6 col-sm-6" >                      
                    <div class="product__item">
                        <div class="product__item__pic set-bg" data-setbg="">
                            <a href="chitietsp.html?id=${sp.id}&id_cate=${sp.cate_id}"><img src="${sp.image}" alt=""> </a>                 
                            <span class="label">Mới</span>
                            <ul class="product__hover">                                          
                                <li><a href="chitietsp.html?id=${sp.id}"><img src="img/icon/search.png" alt=""></a></li>
                            </ul>
                        </div>
                        <div class="product__item__text">
                            <h6>${sp.name}</h6>
                             <a href="chitietsp.html?id=${sp.id}" class="add-cart">+ Xem Chi tiết</a>
                            <h5>${sp.price.toLocaleString('vi', {style : 'currency', currency : 'VND'})}</h5>
                        </div>
                    </div>
                  </div>
                `                        
            });
        })
    </script>
    <script>
      // hiện số lượng sp
      var cart = JSON.parse (localStorage.getItem("cart"))
    
      var hg =  cart.length;
    
       document.querySelector("#hienThiSoLuong").innerHTML+=`<span>${hg}</span>`
      
    </script>
    <script>

        url = `http://localhost:3000/binhluan?id_pro=${id}&_start=0&_end=2&_sort=id&_order=desc`
        fetch(url)
        .then( res => res.json())
        .then( value => {
      
          if(value == ""){
            document.querySelector('#show_bl').innerHTML+= "Chưa có bình luận nào"
          }
          else{
            value.forEach( bl => { 
    
              document.querySelector('#show_bl').innerHTML+= `
                  <div class="col-lg-10 col-md-6 col-sm-6 col-sm-6" style ="margin-bottom: -15%" >                      
                      <div class="product__item">
                          <div class="product__item__pic set-bg" data-setbg="">
                              <h3>Tên: ${bl.name}</h3>   
                              <h3>Email: ${bl.email}</h3>    
                              <h3>Nội dung: ${bl.content}</h3>
                              <hr>
                          </div>    
                      </div>
                  </div>
              `                        
          })
          }

    

        })
    </script>
    <script>
  

      // thêm bình luận
     
      btnLuu = document.querySelector("#button");

      btnLuu.onclick = function(){
        name = document.querySelector("#name").value.trim();
        email = document.querySelector("#email").value.trim();
        phone = document.querySelector("#phone").value.trim();
        content = document.querySelector("#content").value.trim();
        

        if(name == "" || name.length <=2  ){
          alert("không được bỏ trống tên hoặc tên quá ngắn" )
          return
        }
        var check_email = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        var check1 = check_email.test(email)
        if(!check1){
            alert('Vui lòng nhập đúng email');
            return
        }
        else if(email == "" ){
          alert("không được bỏ trống email")
          return
        }


             
        var check_sdt = /^(09|03|07)[0-9]{8}$/;
        var check = check_sdt.test(phone);

          if(!check){
            alert('Vui lòng nhập đúng số điện thoại');
            return
          }

        else if(phone == ""){
          alert("không được bỏ trống số điện thoại hoặc nhập sai định dạng")
          return
        }
        else if(content == "") {
          alert("không được bỏ trống nội dung")
          return
        }
          url = "http://localhost:3000/binhluan";

          bl = {
              name :  name ,      
              email :  email ,      
              phone :  phone  ,     
              content :  content ,
              id_pro: id
          }

          options = {
              method: "post",
              body: JSON.stringify(bl),
              headers:{ "Content-Type": 'application/json'}
          }
          fetch(url,options).then(res => res.json())
          .then( data => {
                alert("Bình luận thành công")
             
          })
      }
  </script>